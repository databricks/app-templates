bundle:
  name: agent_langgraph_short_term_memory

resources:
  # MLflow experiment for agent tracing - automatically created by bundle
  experiments:
    agent_langgraph_short_term_memory_experiment:
      name: /Users/${workspace.current_user.userName}/${bundle.name}-${bundle.target}

  apps:
    agent_langgraph_short_term_memory:
      name: "${bundle.target}-agent-langgraph-short-term-memory"
      description: "LangGraph agent application with short-term memory"
      source_code_path: ./
      config:
        command: ["uv", "run", "start-app"]
        env:
          - name: MLFLOW_TRACKING_URI
            value: "databricks"
          - name: MLFLOW_REGISTRY_URI
            value: "databricks-uc"
          - name: API_PROXY
            value: "http://localhost:8000/invocations"
          - name: CHAT_APP_PORT
            value: "3000"
          - name: CHAT_PROXY_TIMEOUT_SECONDS
            value: "300"
          - name: MLFLOW_EXPERIMENT_ID
            valueFrom: "experiment"
          - name: LAKEBASE_INSTANCE_NAME
            valueFrom: "database"

      # Resources which this app has access to
      resources:
        - name: 'experiment'
          experiment:
            experiment_id: "${resources.experiments.agent_langgraph_short_term_memory_experiment.id}"
            permission: 'CAN_MANAGE'
        - name: 'database'
          database:
            instance_name: '<your-lakebase-instance-name>'
            database_name: 'postgres'
            permission: 'CAN_CONNECT_AND_CREATE'

targets:
  dev:
    mode: development
    default: true
    # workspace:
    #   host: https://...

  prod:
    mode: production
    # workspace:
    #   host: https://...
    resources:
      apps:
        agent_langgraph_short_term_memory:
          name: agent-langgraph-short-term-memory
